
<!DOCTYPE html>
<html lang="en">

<head>
 <meta charset="UTF-8">
 <meta name="viewport" content="width=device-width, initial-scale=1.0">
 <title>Admin Panel - XYZVERSE</title>

 <!-- Google Fonts - Jost -->
 <link href="https://fonts.googleapis.com/css2?family=Jost:wght@300;400;500;600;700&display=swap" rel="stylesheet">
 <!-- Bootstrap CSS -->
 <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
 <!-- Font Awesome -->
 <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
 <!-- SweetAlert2 CSS -->
 <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/sweetalert2@11/dist/sweetalert2.min.css">

 <style>
  :root {
      --primary-color: #2e7d32;
      --secondary-color: #4caf50;
      --accent-color: #81c784;
      --dark-color: #1b1b1b;
      --light-bg: #f5f5f5;
      --dark-text: #333;
      --light-text: #757575;
      --border-radius: 8px;
      --box-shadow: 0 4px 12px rgba(0,0,0,0.1);
      --transition: all 0.3s ease;
  }
  
  * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
  }
  
  body {
      font-family: 'Jost', 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background-color: #f8f9fa;
      color: var(--dark-text);
  }
  
  .login-container {
      min-height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
      background: linear-gradient(135deg, rgba(46, 125, 50, 0.9), rgba(76, 175, 80, 0.8));
  }
  
  .login-card {
      background: white;
      border-radius: var(--border-radius);
      box-shadow: var(--box-shadow);
      padding: 2rem;
      width: 100%;
      max-width: 400px;
  }
  
  .login-logo {
      text-align: center;
      margin-bottom: 1.5rem;
      color: var(--primary-color);
  }
  
  .admin-container {
      display: none;
  }
  
  .sidebar {
      background-color: var(--dark-color);
      color: white;
      height: 100vh;
      position: fixed;
      width: 250px;
      padding-top: 20px;
      transition: var(--transition);
      z-index: 1000;
      overflow-y: auto;
  }
  
  .sidebar-header {
      padding: 0 20px 20px;
      border-bottom: 1px solid rgba(255,255,255,0.1);
      margin-bottom: 20px;
  }
  
  .sidebar-menu {
      list-style: none;
      padding: 0;
  }
  
  .sidebar-menu li {
      margin-bottom: 5px;
  }
  
  .sidebar-menu a {
      color: rgba(255,255,255,0.8);
      text-decoration: none;
      padding: 12px 20px;
      display: block;
      border-radius: 4px;
      transition: var(--transition);
  }
  
  .sidebar-menu a:hover, .sidebar-menu a.active {
      color: white;
      background-color: rgba(255,255,255,0.1);
  }
  
  .sidebar-menu i {
      margin-right: 10px;
      width: 20px;
      text-align: center;
  }
  
  .main-content {
      margin-left: 250px;
      padding: 20px;
      transition: var(--transition);
  }
  
  .navbar {
      background: white;
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
      padding: 15px 20px;
      margin-bottom: 20px;
      border-radius: var(--border-radius);
      display: flex;
      align-items: center;
      justify-content: space-between;
  }
  
  .navbar-left {
      display: flex;
      align-items: center;
  }
  
  .navbar-right {
      display: flex;
      align-items: center;
  }
  
  .admin-section {
      display: none;
      background: white;
      border-radius: var(--border-radius);
      box-shadow: var(--box-shadow);
      padding: 20px;
      margin-bottom: 20px;
  }
  
  .admin-section.active {
      display: block;
  }
  
  .section-title {
      font-size: 1.8rem;
      font-weight: 700;
      margin-bottom: 1.5rem;
      color: var(--dark-color);
      border-bottom: 2px solid var(--primary-color);
      padding-bottom: 10px;
  }
  
  .stat-card {
      background: white;
      border-radius: var(--border-radius);
      box-shadow: var(--box-shadow);
      padding: 20px;
      text-align: center;
      margin-bottom: 20px;
      transition: var(--transition);
  }
  
  .stat-card:hover {
      transform: translateY(-5px);
      box-shadow: 0 8px 20px rgba(0,0,0,0.15);
  }
  
  .stat-icon {
      width: 60px;
      height: 60px;
      border-radius: 50%;
      background: var(--primary-color);
      color: white;
      display: flex;
      align-items: center;
      justify-content: center;
      margin: 0 auto 15px;
      font-size: 1.5rem;
  }
  
  .stat-value {
      font-size: 2rem;
      font-weight: 700;
      color: var(--primary-color);
      margin-bottom: 5px;
  }
  
  .stat-label {
      color: var(--light-text);
      font-size: 0.9rem;
  }
  
  .table-container {
      background: white;
      border-radius: var(--border-radius);
      box-shadow: var(--box-shadow);
      overflow: hidden;
  }
  
  .table th {
      background-color: var(--primary-color);
      color: white;
      border: none;
  }
  
  .table td {
      vertical-align: middle;
  }
  
  .btn-admin {
      background-color: var(--primary-color);
      color: white;
      border: none;
      padding: 8px 15px;
      border-radius: 4px;
      transition: var(--transition);
  }
  
  .btn-admin:hover {
      background-color: var(--secondary-color);
      color: white;
  }
  
  .btn-edit {
      background-color: #ffc107;
      color: white;
  }
  
  .btn-delete {
      background-color: #dc3545;
      color: white;
  }
  
  .form-container {
      background: white;
      border-radius: var(--border-radius);
      box-shadow: var(--box-shadow);
      padding: 20px;
      margin-bottom: 20px;
  }
  
  .toggle-sidebar {
      display: none;
      background: var(--primary-color);
      color: white;
      border: none;
      border-radius: 4px;
      padding: 8px 12px;
      margin-right: 15px;
  }
  
  .coupon-type {
      padding: 5px 10px;
      border-radius: 20px;
      font-size: 0.8rem;
      font-weight: 600;
  }
  
  .type-percentage {
      background: #d4edda;
      color: #155724;
  }
  
  .type-fixed {
      background: #d1edff;
      color: #0c5460;
  }
  
  .export-btn {
      background-color: #17a2b8;
      color: white;
      border: none;
      padding: 8px 15px;
      border-radius: 4px;
      transition: var(--transition);
      margin-left: 10px;
  }
  
  .export-btn:hover {
      background-color: #138496;
      color: white;
  }
  
  .import-btn {
      background-color: #28a745;
      color: white;
      border: none;
      padding: 8px 15px;
      border-radius: 4px;
      transition: var(--transition);
      margin-left: 10px;
  }
  
  .import-btn:hover {
      background-color: #218838;
      color: white;
  }
  
  .order-status {
      padding: 5px 10px;
      border-radius: 20px;
      font-size: 0.8rem;
      font-weight: 600;
  }
  
  .status-pending {
      background: #fff3cd;
      color: #856404;
  }
  
  .status-confirmed {
      background: #d1edff;
      color: #0c5460;
  }
  
  .status-shipped {
      background: #d4edda;
      color: #155724;
  }
  
  .status-delivered {
      background: #d1edff;
      color: #0c5460;
  }
  
  .status-cancelled {
      background: #f8d7da;
      color: #721c24;
  }
  
  .product-image {
      width: 60px;
      height: 60px;
      object-fit: cover;
      border-radius: 4px;
  }
  
  .loading {
      display: flex;
      justify-content: center;
      align-items: center;
      height: 200px;
  }
  
  .spinner {
      width: 50px;
      height: 50px;
      border: 5px solid rgba(46, 125, 50, 0.2);
      border-radius: 50%;
      border-top-color: var(--primary-color);
      animation: spin 1s linear infinite;
  }
  
  @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
  }
  
  .image-preview-container {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      margin-top: 10px;
  }
  
  .image-preview {
      width: 100px;
      height: 100px;
      object-fit: cover;
      border-radius: 4px;
      border: 1px solid #ddd;
  }
  
  .order-details-grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 20px;
  }
  
  .order-items-table {
      width: 100%;
      border-collapse: collapse;
  }
  
  .order-items-table th,
  .order-items-table td {
      padding: 10px;
      text-align: left;
      border-bottom: 1px solid #ddd;
  }
  
  .order-items-table th {
      background-color: #f8f9fa;
  }
  
  .tag-container {
      display: flex;
      flex-wrap: wrap;
      gap: 5px;
      margin-top: 5px;
  }
  
  .tag {
      background-color: #e9ecef;
      padding: 2px 8px;
      border-radius: 12px;
      font-size: 0.8rem;
  }
  
  .color-tag {
      display: inline-flex;
      align-items: center;
      gap: 5px;
  }
  
  .color-indicator {
      width: 12px;
      height: 12px;
      border-radius: 50%;
      display: inline-block;
  }
  
  .hidden-form {
      display: none;
  }
  
  .upload-container {
      margin-bottom: 10px;
      padding: 10px;
      border: 1px solid #ddd;
      border-radius: 5px;
  }
  
  .status {
      margin-top: 10px;
      font-style: italic;
      color: #666;
  }
  
  .progress {
      margin-top: 10px;
      height: 5px;
      background-color: #f0f0f0;
      border-radius: 2px;
      overflow: hidden;
  }
  
  .progress-bar {
      height: 100%;
      background-color: #4CAF50;
      width: 0%;
      transition: width 0.3s;
  }
  
  /* Mobile Styles */
  @media (max-width: 992px) {
      .sidebar {
          width: 70px;
          overflow: hidden;
      }
      
      .sidebar .menu-text {
          display: none;
      }
      
      .sidebar-header h3 {
          display: none;
      }
      
      .main-content {
          margin-left: 70px;
      }
      
      .toggle-sidebar {
          display: inline-block;
      }
      
      .sidebar.expanded {
          width: 250px;
      }
      
      .sidebar.expanded .menu-text {
          display: inline;
      }
      
      .sidebar.expanded .sidebar-header h3 {
          display: block;
      }
  }
  
  @media (max-width: 768px) {
      .sidebar {
          width: 0;
          padding-top: 60px;
      }
      
      .sidebar.expanded {
          width: 250px;
      }
      
      .main-content {
          margin-left: 0;
          padding: 15px;
      }
      
      .navbar {
          flex-direction: column;
          align-items: flex-start;
          padding: 10px 15px;
      }
      
      .navbar-left, .navbar-right {
          width: 100%;
          justify-content: space-between;
          margin-bottom: 10px;
      }
      
      .navbar-right {
          justify-content: flex-end;
      }
      
      .admin-section {
          padding: 15px;
      }
      
      .section-title {
          font-size: 1.5rem;
      }
      
      .stat-card {
          padding: 15px;
      }
      
      .stat-value {
          font-size: 1.5rem;
      }
      
      .form-container {
          padding: 15px;
      }
      
      .table-responsive {
          font-size: 0.85rem;
      }
      
      .table th, .table td {
          padding: 8px 5px;
      }
      
      .product-image {
          width: 40px;
          height: 40px;
      }
      
      .order-details-grid {
          grid-template-columns: 1fr;
      }
      
      .btn-admin, .export-btn, .import-btn {
          padding: 6px 12px;
          font-size: 0.85rem;
      }
      
      .d-flex.justify-content-between.align-items-center.mb-4 {
          flex-direction: column;
          align-items: flex-start;
      }
      
      .d-flex.justify-content-between.align-items-center.mb-4 .btn-group {
          margin-top: 10px;
          width: 100%;
          display: flex;
          flex-wrap: wrap;
          gap: 5px;
      }
      
      .d-flex.justify-content-between.align-items-center.mb-4 .btn-group .btn {
          flex: 1;
          min-width: 120px;
          margin-bottom: 5px;
      }
  }
  
  @media (max-width: 576px) {
      .login-card {
          margin: 15px;
          padding: 1.5rem;
      }
      
      .main-content {
          padding: 10px;
      }
      
      .admin-section {
          padding: 10px;
      }
      
      .section-title {
          font-size: 1.3rem;
      }
      
      .stat-card {
          padding: 10px;
      }
      
      .stat-icon {
          width: 50px;
          height: 50px;
          font-size: 1.2rem;
      }
      
      .stat-value {
          font-size: 1.3rem;
      }
      
      .table-responsive {
          font-size: 0.8rem;
      }
      
      .table th, .table td {
          padding: 6px 3px;
      }
      
      .product-image {
          width: 35px;
          height: 35px;
      }
      
      .btn-admin, .export-btn, .import-btn {
          padding: 5px 10px;
          font-size: 0.8rem;
      }
      
      .modal-dialog {
          margin: 10px;
      }
      
      .modal-content {
          padding: 10px;
      }
      
      .image-preview {
          width: 70px;
          height: 70px;
      }
  }
  
  /* Extra small devices */
  @media (max-width: 400px) {
      .navbar-right span.me-3 {
          display: none;
      }
      
      .table-responsive {
          font-size: 0.75rem;
      }
      
      .btn-admin, .export-btn, .import-btn {
          padding: 4px 8px;
          font-size: 0.75rem;
      }
      
      .stat-card {
          padding: 8px;
      }
      
      .stat-value {
          font-size: 1.1rem;
      }
      
      .stat-label {
          font-size: 0.8rem;
      }
  }
 </style>
</head>

<body>
 <!-- Login Section -->
 <div id="login-section" class="login-container">
  <div class="login-card">
   <div class="login-logo">
    <i class="fas fa-user-shield fa-3x mb-3"></i>
    <h2>XYZVERSE Admin</h2>
    <p class="text-muted">Enter password to access admin panel</p>
   </div>
   <form id="login-form">
    <div class="mb-3">
     <label for="password" class="form-label">Password</label>
     <input type="password" class="form-control" id="password" required>
    </div>
    <button type="submit" class="btn btn-success w-100">Login</button>
   </form>
  </div>
 </div>

 <!-- Admin Panel -->
 <div id="admin-panel" class="admin-container">
  <!-- Sidebar -->
  <div class="sidebar" id="sidebar">
   <div class="sidebar-header">
    <h3><i class="fas fa-user-shield me-2"></i><span class="menu-text">Admin Panel</span></h3>
   </div>
   <ul class="sidebar-menu">
    <li><a href="#" class="active" data-section="dashboard"><i class="fas fa-tachometer-alt"></i><span class="menu-text">Dashboard</span></a></li>
    <li><a href="#" data-section="products"><i class="fas fa-box"></i><span class="menu-text">Products</span></a></li>
    <li><a href="#" data-section="orders"><i class="fas fa-shopping-cart"></i><span class="menu-text">Orders</span></a></li>
    <li><a href="#" data-section="coupons"><i class="fas fa-tag"></i><span class="menu-text">Coupons</span></a></li>
    <li><a href="#" id="logout-btn"><i class="fas fa-sign-out-alt"></i><span class="menu-text">Logout</span></a></li>
   </ul>
  </div>

  <!-- Main Content -->
  <div class="main-content" id="main-content">
   <!-- Navbar -->
   <nav class="navbar">
    <div class="navbar-left">
     <button class="toggle-sidebar" id="toggle-sidebar">
      <i class="fas fa-bars"></i>
     </button>
     <h4 class="mb-0" id="page-title">Dashboard</h4>
    </div>
    <div class="navbar-right">
     <span class="me-3"><i class="fas fa-user me-2"></i>Admin</span>
     <button class="btn btn-sm btn-outline-secondary" id="logout-btn-top">
      <i class="fas fa-sign-out-alt me-1"></i>Logout
     </button>
    </div>
   </nav>

   <!-- Dashboard Section -->
   <section id="dashboard-section" class="admin-section active">
    <h2 class="section-title">Dashboard Overview</h2>

    <div class="row">
     <div class="col-md-3 col-sm-6 mb-3">
      <div class="stat-card">
       <div class="stat-icon">
        <i class="fas fa-box"></i>
       </div>
       <div class="stat-value" id="total-products">0</div>
       <div class="stat-label">Published Products</div>
      </div>
     </div>
     <div class="col-md-3 col-sm-6 mb-3">
      <div class="stat-card">
       <div class="stat-icon">
        <i class="fas fa-shopping-cart"></i>
       </div>
       <div class="stat-value" id="total-orders">0</div>
       <div class="stat-label">Total Orders</div>
      </div>
     </div>
     <div class="col-md-3 col-sm-6 mb-3">
      <div class="stat-card">
       <div class="stat-icon">
        <i class="fas fa-clock"></i>
       </div>
       <div class="stat-value" id="pending-orders">0</div>
       <div class="stat-label">Pending Orders</div>
      </div>
     </div>
     <div class="col-md-3 col-sm-6 mb-3">
      <div class="stat-card">
       <div class="stat-icon">
        <i class="fas fa-money-bill-wave"></i>
       </div>
       <div class="stat-value" id="total-revenue">₹0</div>
       <div class="stat-label">Delivered Revenue</div>
      </div>
     </div>
    </div>

    <div class="row mt-4">
     <div class="col-lg-8 mb-4">
      <div class="table-container">
       <div class="p-3 border-bottom">
        <h5 class="mb-0">Recent Orders</h5>
       </div>
       <div class="table-responsive">
        <table class="table table-hover">
         <thead>
          <tr>
           <th>Order ID</th>
           <th>Customer</th>
           <th>Date</th>
           <th>Amount</th>
           <th>Status</th>
           <th>Action</th>
          </tr>
         </thead>
         <tbody id="recent-orders">
          <!-- Recent orders will be loaded here -->
         </tbody>
        </table>
       </div>
      </div>
     </div>
     <div class="col-lg-4 mb-4">
      <div class="table-container">
       <div class="p-3 border-bottom">
        <h5 class="mb-0">Active Coupons</h5>
       </div>
       <div class="table-responsive">
        <table class="table table-hover">
         <thead>
          <tr>
           <th>Code</th>
           <th>Discount</th>
           <th>Type</th>
          </tr>
         </thead>
         <tbody id="active-coupons">
          <!-- Active coupons will be loaded here -->
         </tbody>
        </table>
       </div>
      </div>
     </div>
    </div>
   </section>

   <!-- Products Section -->
   <section id="products-section" class="admin-section">
    <div class="d-flex justify-content-between align-items-center mb-4">
     <h2 class="section-title mb-0">Products Management</h2>
     <div class="btn-group">
      <button class="btn btn-admin" id="show-add-product-form">
       <i class="fas fa-plus me-2"></i>Add Product
      </button>
      <button class="btn import-btn" data-bs-toggle="modal" data-bs-target="#importProductsModal">
       <i class="fas fa-upload me-2"></i>Import
      </button>
      <button class="btn export-btn" id="export-products-btn">
       <i class="fas fa-download me-2"></i>Export
      </button>
     </div>
    </div>

    <!-- Add Product Form -->
    <div class="form-container hidden-form" id="add-product-form-container">
     <h4 class="mb-4">Add New Product</h4>
     <form id="add-product-form">
      <div class="row">
       <div class="col-md-6 mb-3">
        <label for="product-name" class="form-label">Product Name</label>
        <input type="text" class="form-control" id="product-name" required>
       </div>
       <div class="col-md-6 mb-3">
        <label for="product-category" class="form-label">Category</label>
        <select class="form-control" id="product-category" required>
         <option value="">Select Category</option>
         <option value="Fashion">Fashion</option>
         <option value="Electronics">Electronics</option>
         <option value="Home & Kitchen">Home & Kitchen</option>
         <option value="Beauty">Beauty</option>
         <option value="Sports">Sports</option>
         <option value="Books">Books</option>
         <option value="Food & Grocery">Food & Grocery</option>
        </select>
       </div>
      </div>
      <div class="mb-3">
       <label for="product-description" class="form-label">Description</label>
       <textarea class="form-control" id="product-description" rows="3" required></textarea>
      </div>
      <div class="row">
       <div class="col-md-6 mb-3">
        <label for="product-price" class="form-label">Price (₹)</label>
        <input type="number" class="form-control" id="product-price" min="0" step="0.01" required>
       </div>
       <div class="col-md-6 mb-3">
        <label for="product-original-price" class="form-label">Original Price (₹)</label>
        <input type="number" class="form-control" id="product-original-price" min="0" step="0.01">
       </div>
      </div>
      <div class="mb-3">
       <label for="product-images" class="form-label">Product Images</label>
       <div class="upload-container">
        <input type="file" id="fileInput" multiple accept="image/*">
        <button type="button" class="btn btn-sm btn-admin mt-2" id="uploadBtn">Upload Images</button>
        <div class="progress mt-2" id="progressContainer" style="display: none;">
         <div class="progress-bar" id="progressBar"></div>
        </div>
        <div class="status" id="status"></div>
       </div>
       <textarea class="form-control mt-2" id="product-images" rows="3" placeholder="Image URLs will appear here after upload"></textarea>
       <div class="image-preview-container" id="image-preview-container">
        <!-- Image previews will be shown here -->
       </div>
      </div>
      <div class="row">
       <div class="col-md-6 mb-3">
        <label for="product-sizes" class="form-label">Available Sizes (comma separated)</label>
        <input type="text" class="form-control" id="product-sizes" placeholder="S, M, L, XL">
        <div class="tag-container" id="sizes-tags-container">
         <!-- Size tags will be shown here -->
        </div>
       </div>
       <div class="col-md-6 mb-3">
        <label for="product-colors" class="form-label">Available Colors (comma separated)</label>
        <input type="text" class="form-control" id="product-colors" placeholder="Red, Blue, Green">
        <div class="tag-container" id="colors-tags-container">
         <!-- Color tags will be shown here -->
        </div>
       </div>
      </div>
      <div class="mb-3">
       <div class="form-check form-check-inline">
        <input class="form-check-input" type="radio" name="product-publish" id="product-publish" value="publish" checked>
        <label class="form-check-label" for="product-publish">
         Publish Product
        </label>
       </div>
       <div class="form-check form-check-inline">
        <input class="form-check-input" type="radio" name="product-publish" id="product-draft" value="draft">
        <label class="form-check-label" for="product-draft">
         Save as Draft
        </label>
       </div>
      </div>
      <div class="d-flex justify-content-end">
       <button type="button" class="btn btn-secondary me-2" id="cancel-add-product">Cancel</button>
       <button type="submit" class="btn btn-admin">Add Product</button>
      </div>
     </form>
    </div>

    <!-- Products List -->
    <ul class="nav nav-tabs mb-4" id="productsTab" role="tablist">
     <li class="nav-item" role="presentation">
      <button class="nav-link active" id="published-tab" data-bs-toggle="tab" data-bs-target="#published" type="button" role="tab">Published Products</button>
     </li>
     <li class="nav-item" role="presentation">
      <button class="nav-link" id="draft-tab" data-bs-toggle="tab" data-bs-target="#draft" type="button" role="tab">Draft Products</button>
     </li>
    </ul>

    <div class="tab-content" id="productsTabContent">
     <div class="tab-pane fade show active" id="published" role="tabpanel">
      <div class="table-container">
       <div class="table-responsive">
        <table class="table table-hover">
         <thead>
          <tr>
           <th>Image</th>
           <th>Name</th>
           <th>Category</th>
           <th>Price</th>
           <th>Actions</th>
          </tr>
         </thead>
         <tbody id="published-products">
          <!-- Published products will be loaded here -->
         </tbody>
        </table>
       </div>
      </div>
     </div>
     <div class="tab-pane fade" id="draft" role="tabpanel">
      <div class="table-container">
       <div class="table-responsive">
        <table class="table table-hover">
         <thead>
          <tr>
           <th>Image</th>
           <th>Name</th>
           <th>Category</th>
           <th>Price</th>
           <th>Actions</th>
          </tr>
         </thead>
         <tbody id="draft-products">
          <!-- Draft products will be loaded here -->
         </tbody>
        </table>
       </div>
      </div>
     </div>
    </div>
   </section>

   <!-- Orders Section -->
   <section id="orders-section" class="admin-section">
    <h2 class="section-title">Orders Management</h2>

    <ul class="nav nav-tabs mb-4" id="ordersTab" role="tablist">
     <li class="nav-item" role="presentation">
      <button class="nav-link active" id="all-orders-tab" data-bs-toggle="tab" data-bs-target="#all-orders" type="button" role="tab">All Orders</button>
     </li>
     <li class="nav-item" role="presentation">
      <button class="nav-link" id="delivered-orders-tab" data-bs-toggle="tab" data-bs-target="#delivered-orders" type="button" role="tab">Delivered Orders</button>
     </li>
     <li class="nav-item" role="presentation">
      <button class="nav-link" id="cancelled-orders-tab" data-bs-toggle="tab" data-bs-target="#cancelled-orders" type="button" role="tab">Cancelled Orders</button>
     </li>
    </ul>

    <div class="tab-content" id="ordersTabContent">
     <div class="tab-pane fade show active" id="all-orders" role="tabpanel">
      <div class="table-container">
       <div class="table-responsive">
        <table class="table table-hover">
         <thead>
          <tr>
           <th>Order ID</th>
           <th>Customer</th>
           <th>Date</th>
           <th>Products</th>
           <th>Amount</th>
           <th>Status</th>
           <th>Actions</th>
          </tr>
         </thead>
         <tbody id="orders-list">
          <!-- All orders except delivered and cancelled will be loaded here -->
         </tbody>
        </table>
       </div>
      </div>
     </div>
     <div class="tab-pane fade" id="delivered-orders" role="tabpanel">
      <div class="table-container">
       <div class="table-responsive">
        <table class="table table-hover">
         <thead>
          <tr>
           <th>Order ID</th>
           <th>Customer</th>
           <th>Date</th>
           <th>Products</th>
           <th>Amount</th>
           <th>Status</th>
           <th>Actions</th>
          </tr>
         </thead>
         <tbody id="delivered-orders-list">
          <!-- Delivered orders will be loaded here -->
         </tbody>
        </table>
       </div>
      </div>
     </div>
     <div class="tab-pane fade" id="cancelled-orders" role="tabpanel">
      <div class="table-container">
       <div class="table-responsive">
        <table class="table table-hover">
         <thead>
          <tr>
           <th>Order ID</th>
           <th>Customer</th>
           <th>Date</th>
           <th>Products</th>
           <th>Amount</th>
           <th>Status</th>
           <th>Actions</th>
          </tr>
         </thead>
         <tbody id="cancelled-orders-list">
          <!-- Cancelled orders will be loaded here -->
         </tbody>
        </table>
       </div>
      </div>
     </div>
    </div>
   </section>

   <!-- Coupons Section -->
   <section id="coupons-section" class="admin-section">
    <div class="d-flex justify-content-between align-items-center mb-4">
     <h2 class="section-title mb-0">Coupons Management</h2>
     <button class="btn btn-admin" data-bs-toggle="modal" data-bs-target="#addCouponModal">
      <i class="fas fa-plus me-2"></i>Add Coupon
     </button>
    </div>

    <div class="table-container">
     <div class="table-responsive">
      <table class="table table-hover">
       <thead>
        <tr>
         <th>Code</th>
         <th>Discount</th>
         <th>Type</th>
         <th>Actions</th>
        </tr>
       </thead>
       <tbody id="coupons-list">
        <!-- Coupons will be loaded here -->
       </tbody>
      </table>
     </div>
    </div>
   </section>
  </div>
 </div>

 <!-- Add Coupon Modal -->
 <div class="modal fade" id="addCouponModal" tabindex="-1">
  <div class="modal-dialog">
   <div class="modal-content">
    <div class="modal-header">
     <h5 class="modal-title">Add New Coupon</h5>
     <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
    </div>
    <div class="modal-body">
     <form id="add-coupon-form">
      <div class="mb-3">
       <label for="coupon-code" class="form-label">Coupon Code</label>
       <input type="text" class="form-control" id="coupon-code" required>
      </div>
      <div class="mb-3">
       <label for="coupon-discount" class="form-label">Discount Value</label>
       <input type="number" class="form-control" id="coupon-discount" min="0" step="0.01" required>
      </div>
      <div class="mb-3">
       <label for="coupon-type" class="form-label">Discount Type</label>
       <select class="form-control" id="coupon-type" required>
        <option value="percentage">Percentage (%)</option>
        <option value="fixed">Fixed Amount (₹)</option>
       </select>
      </div>
      <div class="d-flex justify-content-end">
       <button type="button" class="btn btn-secondary me-2" data-bs-dismiss="modal">Cancel</button>
       <button type="submit" class="btn btn-admin">Add Coupon</button>
      </div>
     </form>
    </div>
   </div>
  </div>
 </div>

 <!-- Import Products Modal -->
 <div class="modal fade" id="importProductsModal" tabindex="-1">
  <div class="modal-dialog">
   <div class="modal-content">
    <div class="modal-header">
     <h5 class="modal-title">Import Products</h5>
     <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
    </div>
    <div class="modal-body">
     <form id="import-products-form">
      <div class="mb-3">
       <label for="import-file" class="form-label">Select JSON File</label>
       <input type="file" class="form-control" id="import-file" accept=".json" required>
       <div class="form-text">Select a JSON file containing product data</div>
      </div>
      <div class="mb-3">
       <label for="import-type" class="form-label">Import As</label>
       <select class="form-control" id="import-type" required>
        <option value="publish">Published Products</option>
        <option value="draft">Draft Products</option>
       </select>
      </div>
      <div class="mb-3 form-check">
       <input type="checkbox" class="form-check-input" id="overwrite-existing">
       <label class="form-check-label" for="overwrite-existing">Overwrite existing products with same ID</label>
      </div>
      <div class="d-flex justify-content-end">
       <button type="button" class="btn btn-secondary me-2" data-bs-dismiss="modal">Cancel</button>
       <button type="submit" class="btn btn-admin">Import Products</button>
      </div>
     </form>
    </div>
   </div>
  </div>
 </div>

 <!-- Edit Product Modal -->
 <div class="modal fade" id="editProductModal" tabindex="-1">
  <div class="modal-dialog modal-lg">
   <div class="modal-content">
    <div class="modal-header">
     <h5 class="modal-title">Edit Product</h5>
     <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
    </div>
    <div class="modal-body">
     <form id="edit-product-form">
      <input type="hidden" id="edit-product-id">
      <input type="hidden" id="edit-product-type">
      <div class="row">
       <div class="col-md-6 mb-3">
        <label for="edit-product-name" class="form-label">Product Name</label>
        <input type="text" class="form-control" id="edit-product-name" required>
       </div>
       <div class="col-md-6 mb-3">
        <label for="edit-product-category" class="form-label">Category</label>
        <select class="form-control" id="edit-product-category" required>
         <option value="">Select Category</option>
         <option value="Fashion">Fashion</option>
         <option value="Electronics">Electronics</option>
         <option value="Home & Kitchen">Home & Kitchen</option>
         <option value="Beauty">Beauty</option>
         <option value="Sports">Sports</option>
         <option value="Books">Books</option>
         <option value="Food & Grocery">Food & Grocery</option>
        </select>
       </div>
      </div>
      <div class="mb-3">
       <label for="edit-product-description" class="form-label">Description</label>
       <textarea class="form-control" id="edit-product-description" rows="3" required></textarea>
      </div>
      <div class="row">
       <div class="col-md-6 mb-3">
        <label for="edit-product-price" class="form-label">Price (₹)</label>
        <input type="number" class="form-control" id="edit-product-price" min="0" step="0.01" required>
       </div>
       <div class="col-md-6 mb-3">
        <label for="edit-product-original-price" class="form-label">Original Price (₹)</label>
        <input type="number" class="form-control" id="edit-product-original-price" min="0" step="0.01">
       </div>
      </div>
      <div class="mb-3">
       <label for="edit-product-images" class="form-label">Product Images (URLs, one per line)</label>
       <textarea class="form-control" id="edit-product-images" rows="3" placeholder="https://example.com/image1.jpg&#10;https://example.com/image2.jpg" oninput="updateEditImagePreview()"></textarea>
       <div class="image-preview-container" id="edit-image-preview-container">
        <!-- Image previews will be shown here -->
       </div>
      </div>
      <div class="row">
       <div class="col-md-6 mb-3">
        <label for="edit-product-sizes" class="form-label">Available Sizes (comma separated)</label>
        <input type="text" class="form-control" id="edit-product-sizes" placeholder="S, M, L, XL">
        <div class="tag-container" id="edit-sizes-tags-container">
         <!-- Size tags will be shown here -->
        </div>
       </div>
       <div class="col-md-6 mb-3">
        <label for="edit-product-colors" class="form-label">Available Colors (comma separated)</label>
        <input type="text" class="form-control" id="edit-product-colors" placeholder="Red, Blue, Green">
        <div class="tag-container" id="edit-colors-tags-container">
         <!-- Color tags will be shown here -->
        </div>
       </div>
      </div>
      <div class="d-flex justify-content-end">
       <button type="button" class="btn btn-secondary me-2" data-bs-dismiss="modal">Cancel</button>
       <button type="submit" class="btn btn-admin">Update Product</button>
      </div>
     </form>
    </div>
   </div>
  </div>
 </div>

 <!-- Order Details Modal -->
 <div class="modal fade" id="orderDetailsModal" tabindex="-1">
  <div class="modal-dialog modal-lg">
   <div class="modal-content">
    <div class="modal-header">
     <h5 class="modal-title">Order Details</h5>
     <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
    </div>
    <div class="modal-body" id="order-details-body">
     <!-- Order details will be loaded here -->
    </div>
   </div>
  </div>
 </div>

 <!-- Scripts -->
 <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
 <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
 <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-app-compat.js"></script>
 <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-database-compat.js"></script>

 <script>
  // Firebase Configuration
  const firebaseConfig = {
            apiKey: "AIzaSyDcxsWDh_bvT9akEJfgZ8EtTj6aQyS2sOg",
            authDomain: "sagar-314f1.firebaseapp.com",
            databaseURL: "https://sagar-314f1-default-rtdb.firebaseio.com",
            projectId: "sagar-314f1",
            storageBucket: "sagar-314f1.firebasestorage.app",
            messagingSenderId: "988476325571",
            appId: "1:988476325571:web:2dfeef2e49217da2b9ac76",
            measurementId: "G-B0N4D6WLHJ"
        };

  
  // Initialize Firebase
  firebase.initializeApp(firebaseConfig);
  const database = firebase.database();
  
  // DOM Elements
  const loginSection = document.getElementById('login-section');
  const adminPanel = document.getElementById('admin-panel');
  const loginForm = document.getElementById('login-form');
  const passwordInput = document.getElementById('password');
  const sidebar = document.getElementById('sidebar');
  const toggleSidebar = document.getElementById('toggle-sidebar');
  const mainContent = document.getElementById('main-content');
  const pageTitle = document.getElementById('page-title');
  const logoutBtn = document.getElementById('logout-btn');
  const logoutBtnTop = document.getElementById('logout-btn-top');
  const adminSections = document.querySelectorAll('.admin-section');
  const sidebarLinks = document.querySelectorAll('.sidebar-menu a');
  const showAddProductFormBtn = document.getElementById('show-add-product-form');
  const addProductFormContainer = document.getElementById('add-product-form-container');
  const cancelAddProductBtn = document.getElementById('cancel-add-product');
  const exportProductsBtn = document.getElementById('export-products-btn');
  const importProductsForm = document.getElementById('import-products-form');
  const uploadBtn = document.getElementById('uploadBtn');
  
  // Admin data
  let adminPassword = localStorage.getItem('adminPassword') || 'budhuu0956';
  let products = [];
  let drafts = [];
  let orders = [];
  let coupons = [];
  
  // Color mapping for color swatches
  const colorMap = {
      'Black': '#000000',
      'White': '#ffffff',
      'Red': '#ff0000',
      'Blue': '#0000ff',
      'Green': '#008000',
      'Yellow': '#ffff00',
      'Pink': '#ffc0cb',
      'Purple': '#800080',
      'Orange': '#ffa500',
      'Gray': '#808080',
      'Brown': '#a52a2a',
      'Navy': '#000080',
      'Teal': '#008080',
      'Maroon': '#800000',
      'Olive': '#808000',
      'Silver': '#c0c0c0',
      'Gold': '#ffd700',
      'Beige': '#f5f5dc',
      'Charcoal': '#36454f'
  };
  
  // Initialize the admin panel
  document.addEventListener('DOMContentLoaded', function() {
      // Check if already logged in
      if (localStorage.getItem('adminLoggedIn') === 'true') {
          showAdminPanel();
      }
      
      // Login form submission
      loginForm.addEventListener('submit', handleLogin);
      
      // Sidebar toggle
      toggleSidebar.addEventListener('click', function() {
          sidebar.classList.toggle('expanded');
      });
      
      // Sidebar navigation
      sidebarLinks.forEach(link => {
          link.addEventListener('click', function(e) {
              e.preventDefault();
              
              // Remove active class from all links
              sidebarLinks.forEach(l => l.classList.remove('active'));
              
              // Add active class to clicked link
              this.classList.add('active');
              
              // Show the corresponding section
              const section = this.getAttribute('data-section');
              showSection(section);
              
              // Update page title
              pageTitle.textContent = this.querySelector('.menu-text').textContent;
              
              // Close sidebar on mobile after selection
              if (window.innerWidth < 992) {
                  sidebar.classList.remove('expanded');
              }
          });
      });
      
      // Logout functionality
      logoutBtn.addEventListener('click', handleLogout);
      logoutBtnTop.addEventListener('click', handleLogout);
      
      // Add product form toggle
      showAddProductFormBtn.addEventListener('click', function() {
          addProductFormContainer.classList.remove('hidden-form');
          showAddProductFormBtn.style.display = 'none';
      });
      
      cancelAddProductBtn.addEventListener('click', function() {
          addProductFormContainer.classList.add('hidden-form');
          showAddProductFormBtn.style.display = 'block';
          document.getElementById('add-product-form').reset();
          document.getElementById('image-preview-container').innerHTML = '';
          document.getElementById('sizes-tags-container').innerHTML = '';
          document.getElementById('colors-tags-container').innerHTML = '';
      });
      
      // Form submissions
      document.getElementById('add-product-form').addEventListener('submit', handleAddProduct);
      document.getElementById('edit-product-form').addEventListener('submit', handleEditProduct);
      document.getElementById('add-coupon-form').addEventListener('submit', handleAddCoupon);
      importProductsForm.addEventListener('submit', handleImportProducts);
      
      // Tag creation for sizes and colors
      document.getElementById('product-sizes').addEventListener('input', updateSizeTags);
      document.getElementById('product-colors').addEventListener('input', updateColorTags);
      document.getElementById('edit-product-sizes').addEventListener('input', updateEditSizeTags);
      document.getElementById('edit-product-colors').addEventListener('input', updateEditColorTags);
      
      // Export products button
      exportProductsBtn.addEventListener('click', exportProductsToJSON);
      
      // Image upload button
      uploadBtn.addEventListener('click', uploadImages);
  });
  
  // Handle Login
  function handleLogin(e) {
      e.preventDefault();
      
      const password = passwordInput.value;
      
      if (password === adminPassword) {
          localStorage.setItem('adminLoggedIn', 'true');
          showAdminPanel();
          Swal.fire('Success!', 'You have successfully logged in.', 'success');
      } else {
          Swal.fire('Error!', 'Invalid password. Please try again.', 'error');
      }
  }
  
  // Show Admin Panel
  function showAdminPanel() {
      loginSection.style.display = 'none';
      adminPanel.style.display = 'block';
      
      // Load initial data
      loadDashboardData();
      loadProducts();
      loadOrders();
      loadCoupons();
  }
  
  // Handle Logout
  function handleLogout() {
      Swal.fire({
          title: 'Logout?',
          text: 'Are you sure you want to logout?',
          icon: 'warning',
          showCancelButton: true,
          confirmButtonText: 'Yes, Logout',
          cancelButtonText: 'Cancel'
      }).then((result) => {
          if (result.isConfirmed) {
              localStorage.removeItem('adminLoggedIn');
              loginSection.style.display = 'flex';
              adminPanel.style.display = 'none';
              passwordInput.value = '';
          }
      });
  }
  
  // Show Section
  function showSection(sectionName) {
      // Hide all sections
      adminSections.forEach(section => {
          section.classList.remove('active');
      });
      
      // Show the selected section
      const targetSection = document.getElementById(`${sectionName}-section`);
      if (targetSection) {
          targetSection.classList.add('active');
          
          // Load section-specific data
          if (sectionName === 'dashboard') {
              loadDashboardData();
          } else if (sectionName === 'products') {
              loadProducts();
          } else if (sectionName === 'orders') {
              loadOrders();
          } else if (sectionName === 'coupons') {
              loadCoupons();
          }
      }
  }
  
  // Load Dashboard Data
  function loadDashboardData() {
      // Show loading
      document.getElementById('recent-orders').innerHTML = `
          <tr>
              <td colspan="6" class="text-center">
                  <div class="loading">
                      <div class="spinner"></div>
                  </div>
              </td>
          </tr>
      `;
      
      document.getElementById('active-coupons').innerHTML = `
          <tr>
              <td colspan="3" class="text-center">
                  <div class="loading">
                      <div class="spinner"></div>
                  </div>
              </td>
          </tr>
      `;
      
      // Load products
      database.ref('products').once('value')
          .then((snapshot) => {
              const productsData = snapshot.val();
              products = productsData ? Object.entries(productsData).map(([key, value]) => ({ 
                  id: key, 
                  ...value 
              })) : [];
              
              // Update product stats
              document.getElementById('total-products').textContent = products.length;
          })
          .catch((error) => {
              console.error('Error loading products:', error);
          });
      
      // Load orders
      database.ref('orders').once('value')
          .then((snapshot) => {
              const ordersData = snapshot.val();
              orders = ordersData ? Object.entries(ordersData).map(([key, value]) => ({ 
                  id: key, 
                  ...value 
              })) : [];
              
              // Update order stats
              document.getElementById('total-orders').textContent = orders.length;
              
              // Calculate pending orders
              const pendingOrders = orders.filter(order => order.status === 'pending');
              document.getElementById('pending-orders').textContent = pendingOrders.length;
              
              // Calculate total revenue from delivered orders only
              const deliveredOrders = orders.filter(order => order.status === 'delivered');
              const totalRevenue = deliveredOrders.reduce((sum, order) => {
                  const total = parseFloat(order.total.replace('₹', '')) || 0;
                  return sum + total;
              }, 0);
              document.getElementById('total-revenue').textContent = `₹${totalRevenue.toFixed(2)}`;
              
              // Show recent orders (last 5) excluding delivered and cancelled
              const recentOrders = orders
                  .filter(order => order.status !== 'delivered' && order.status !== 'cancelled')
                  .slice(-5)
                  .reverse();
              
              document.getElementById('recent-orders').innerHTML = recentOrders.map(order => `
                  <tr>
                      <td>${order.orderId}</td>
                      <td>${order.name}</td>
                      <td>${new Date(order.orderDate).toLocaleDateString()}</td>
                      <td>${order.total}</td>
                      <td><span class="order-status status-${order.status}">${order.status}</span></td>
                      <td>
                          <button class="btn btn-sm btn-admin" onclick="viewOrderDetails('${order.id}')">
                              <i class="fas fa-eye"></i>
                          </button>
                      </td>
                  </tr>
              `).join('');
              
              if (recentOrders.length === 0) {
                  document.getElementById('recent-orders').innerHTML = `
                      <tr>
                          <td colspan="6" class="text-center">No recent orders</td>
                      </tr>
                  `;
              }
          })
          .catch((error) => {
              console.error('Error loading orders:', error);
              Swal.fire('Error!', 'There was a problem loading orders.', 'error');
          });
      
      // Load coupons
      database.ref('coupons').once('value')
          .then((snapshot) => {
              const couponsData = snapshot.val();
              coupons = couponsData ? Object.entries(couponsData).map(([key, value]) => ({ 
                  id: key, 
                  ...value 
              })) : [];
              
              // Show active coupons
              const activeCoupons = coupons.filter(c => c.active !== false);
              document.getElementById('active-coupons').innerHTML = activeCoupons.map(coupon => `
                  <tr>
                      <td>${coupon.code}</td>
                      <td>${coupon.discountValue}${coupon.type === 'percentage' ? '%' : '₹'}</td>
                      <td><span class="coupon-type type-${coupon.type}">${coupon.type}</span></td>
                  </tr>
              `).join('');
              
              if (activeCoupons.length === 0) {
                  document.getElementById('active-coupons').innerHTML = `
                      <tr>
                          <td colspan="3" class="text-center">No active coupons</td>
                      </tr>
                  `;
              }
          })
          .catch((error) => {
              console.error('Error loading coupons:', error);
          });
  }
  
  // Load Products
  function loadProducts() {
      // Show loading
      document.getElementById('published-products').innerHTML = `
          <tr>
              <td colspan="5" class="text-center">
                  <div class="loading">
                      <div class="spinner"></div>
                  </div>
              </td>
          </tr>
      `;
      
      document.getElementById('draft-products').innerHTML = `
          <tr>
              <td colspan="5" class="text-center">
                  <div class="loading">
                      <div class="spinner"></div>
                  </div>
              </td>
          </tr>
      `;
      
      // Load published products
      database.ref('products').once('value')
          .then((snapshot) => {
              const productsData = snapshot.val();
              products = productsData ? Object.entries(productsData).map(([key, value]) => ({ 
                  id: key, 
                  ...value 
              })) : [];
              
              // Reverse the order to show newest first
              products.reverse();
              
              // Display published products
              document.getElementById('published-products').innerHTML = products.map(product => `
                  <tr>
                      <td>
                          <img src="${product.images && product.images.length > 0 ? product.images[0] : 'https://via.placeholder.com/60'}" 
                               class="product-image" alt="${product.name}">
                      </td>
                      <td>
                          <div>${product.name}</div>
                          ${product.colors && product.colors.length > 0 ? `
                              <div class="tag-container">
                                  ${product.colors.map(color => `
                                      <span class="tag color-tag">
                                          <span class="color-indicator" style="background-color: ${colorMap[color] || color};"></span>
                                          ${color}
                                      </span>
                                  `).join('')}
                              </div>
                          ` : ''}
                          ${product.sizes && product.sizes.length > 0 ? `
                              <div class="tag-container">
                                  ${product.sizes.map(size => `
                                      <span class="tag">${size}</span>
                                  `).join('')}
                              </div>
                          ` : ''}
                      </td>
                      <td>${product.category}</td>
                      <td>₹${product.price}</td>
                      <td>
                          <button class="btn btn-sm btn-admin me-1" onclick="editProduct('${product.id}', 'published')">
                              <i class="fas fa-edit"></i>
                          </button>
                          <button class="btn btn-sm btn-admin me-1" onclick="moveToDraft('${product.id}')">
                              <i class="fas fa-archive"></i>
                          </button>
                          <button class="btn btn-sm btn-delete" onclick="deleteProduct('${product.id}', 'published')">
                              <i class="fas fa-trash"></i>
                          </button>
                      </td>
                  </tr>
              `).join('');
              
              if (products.length === 0) {
                  document.getElementById('published-products').innerHTML = `
                      <tr>
                          <td colspan="5" class="text-center">No published products</td>
                      </tr>
                  `;
              }
          })
          .catch((error) => {
              console.error('Error loading products:', error);
              Swal.fire('Error!', 'There was a problem loading products.', 'error');
          });
      
      // Load draft products
      database.ref('drafts').once('value')
          .then((snapshot) => {
              const draftsData = snapshot.val();
              drafts = draftsData ? Object.entries(draftsData).map(([key, value]) => ({ 
                  id: key, 
                  ...value 
              })) : [];
              
              // Reverse the order to show newest first
              drafts.reverse();
              
              // Display draft products
              document.getElementById('draft-products').innerHTML = drafts.map(product => `
                  <tr>
                      <td>
                          <img src="${product.images && product.images.length > 0 ? product.images[0] : 'https://via.placeholder.com/60'}" 
                               class="product-image" alt="${product.name}">
                      </td>
                      <td>
                          <div>${product.name}</div>
                          ${product.colors && product.colors.length > 0 ? `
                              <div class="tag-container">
                                  ${product.colors.map(color => `
                                      <span class="tag color-tag">
                                          <span class="color-indicator" style="background-color: ${colorMap[color] || color};"></span>
                                          ${color}
                                      </span>
                                  `).join('')}
                              </div>
                          ` : ''}
                          ${product.sizes && product.sizes.length > 0 ? `
                              <div class="tag-container">
                                  ${product.sizes.map(size => `
                                      <span class="tag">${size}</span>
                                  `).join('')}
                              </div>
                          ` : ''}
                      </td>
                      <td>${product.category}</td>
                      <td>₹${product.price}</td>
                      <td>
                          <button class="btn btn-sm btn-admin me-1" onclick="editProduct('${product.id}', 'draft')">
                              <i class="fas fa-edit"></i>
                          </button>
                          <button class="btn btn-sm btn-admin me-1" onclick="moveToPublished('${product.id}')">
                              <i class="fas fa-check"></i>
                          </button>
                          <button class="btn btn-sm btn-delete" onclick="deleteProduct('${product.id}', 'draft')">
                              <i class="fas fa-trash"></i>
                          </button>
                      </td>
                  </tr>
              `).join('');
              
              if (drafts.length === 0) {
                  document.getElementById('draft-products').innerHTML = `
                      <tr>
                          <td colspan="5" class="text-center">No draft products</td>
                      </tr>
                  `;
              }
          })
          .catch((error) => {
              console.error('Error loading drafts:', error);
              Swal.fire('Error!', 'There was a problem loading draft products.', 'error');
          });
  }
  
  // Load Orders
  function loadOrders() {
      // Show loading
      document.getElementById('orders-list').innerHTML = `
          <tr>
              <td colspan="7" class="text-center">
                  <div class="loading">
                      <div class="spinner"></div>
                  </div>
              </td>
          </tr>
      `;
      
      document.getElementById('delivered-orders-list').innerHTML = `
          <tr>
              <td colspan="7" class="text-center">
                  <div class="loading">
                      <div class="spinner"></div>
                  </div>
              </td>
          </tr>
      `;
      
      document.getElementById('cancelled-orders-list').innerHTML = `
          <tr>
              <td colspan="7" class="text-center">
                  <div class="loading">
                      <div class="spinner"></div>
                  </div>
              </td>
          </tr>
      `;
      
      database.ref('orders').once('value')
          .then((snapshot) => {
              const ordersData = snapshot.val();
              orders = ordersData ? Object.entries(ordersData).map(([key, value]) => ({ 
                  id: key, 
                  ...value 
              })) : [];
              
              // Sort orders by date (newest first)
              orders.sort((a, b) => {
                  const dateA = new Date(a.orderDate || a.createdAt || 0);
                  const dateB = new Date(b.orderDate || b.createdAt || 0);
                  return dateB - dateA;
              });
              
              // Separate orders by status
              const activeOrders = orders.filter(order => order.status !== 'delivered' && order.status !== 'cancelled');
              const deliveredOrders = orders.filter(order => order.status === 'delivered');
              const cancelledOrders = orders.filter(order => order.status === 'cancelled');
              
              // Display active orders (all orders except delivered and cancelled)
              document.getElementById('orders-list').innerHTML = activeOrders.map(order => `
                  <tr>
                      <td>${order.orderId || order.id}</td>
                      <td>${order.name || 'N/A'}</td>
                      <td>${order.orderDate ? new Date(order.orderDate).toLocaleDateString() : 'N/A'}</td>
                      <td>
                          ${order.items && order.items.length > 0 ? 
                              order.items.map(item => item.name).join(', ') : 
                              order.productNames || 'N/A'
                          }
                      </td>
                      <td>${order.total || '₹0'}</td>
                      <td>
                          <select class="form-select form-select-sm" onchange="updateOrderStatus('${order.id}', this.value)">
                              <option value="pending" ${order.status === 'pending' ? 'selected' : ''}>Pending</option>
                              <option value="confirmed" ${order.status === 'confirmed' ? 'selected' : ''}>Confirmed</option>
                              <option value="shipped" ${order.status === 'shipped' ? 'selected' : ''}>Shipped</option>
                              <option value="delivered" ${order.status === 'delivered' ? 'selected' : ''}>Delivered</option>
                              <option value="cancelled" ${order.status === 'cancelled' ? 'selected' : ''}>Cancelled</option>
                          </select>
                      </td>
                      <td>
                          <button class="btn btn-sm btn-admin" onclick="viewOrderDetails('${order.id}')">
                              <i class="fas fa-eye"></i>
                          </button>
                      </td>
                  </tr>
              `).join('');
              
              if (activeOrders.length === 0) {
                  document.getElementById('orders-list').innerHTML = `
                      <tr>
                          <td colspan="7" class="text-center">No active orders</td>
                      </tr>
                  `;
              }
              
              // Display delivered orders
              document.getElementById('delivered-orders-list').innerHTML = deliveredOrders.map(order => `
                  <tr>
                      <td>${order.orderId || order.id}</td>
                      <td>${order.name || 'N/A'}</td>
                      <td>${order.orderDate ? new Date(order.orderDate).toLocaleDateString() : 'N/A'}</td>
                      <td>
                          ${order.items && order.items.length > 0 ? 
                              order.items.map(item => item.name).join(', ') : 
                              order.productNames || 'N/A'
                          }
                      </td>
                      <td>${order.total || '₹0'}</td>
                      <td>
                          <span class="order-status status-${order.status}">${order.status}</span>
                      </td>
                      <td>
                          <button class="btn btn-sm btn-admin" onclick="viewOrderDetails('${order.id}')">
                              <i class="fas fa-eye"></i>
                          </button>
                      </td>
                  </tr>
              `).join('');
              
              if (deliveredOrders.length === 0) {
                  document.getElementById('delivered-orders-list').innerHTML = `
                      <tr>
                          <td colspan="7" class="text-center">No delivered orders</td>
                      </tr>
                  `;
              }
              
              // Display cancelled orders
              document.getElementById('cancelled-orders-list').innerHTML = cancelledOrders.map(order => `
                  <tr>
                      <td>${order.orderId || order.id}</td>
                      <td>${order.name || 'N/A'}</td>
                      <td>${order.orderDate ? new Date(order.orderDate).toLocaleDateString() : 'N/A'}</td>
                      <td>
                          ${order.items && order.items.length > 0 ? 
                              order.items.map(item => item.name).join(', ') : 
                              order.productNames || 'N/A'
                          }
                      </td>
                      <td>${order.total || '₹0'}</td>
                      <td>
                          <span class="order-status status-${order.status}">${order.status}</span>
                      </td>
                      <td>
                          <button class="btn btn-sm btn-admin" onclick="viewOrderDetails('${order.id}')">
                              <i class="fas fa-eye"></i>
                          </button>
                      </td>
                  </tr>
              `).join('');
              
              if (cancelledOrders.length === 0) {
                  document.getElementById('cancelled-orders-list').innerHTML = `
                      <tr>
                          <td colspan="7" class="text-center">No cancelled orders</td>
                      </tr>
                  `;
              }
          })
          .catch((error) => {
              console.error('Error loading orders:', error);
              Swal.fire('Error!', 'There was a problem loading orders.', 'error');
          });
  }
  
  // Load Coupons
  function loadCoupons() {
      // Show loading
      document.getElementById('coupons-list').innerHTML = `
          <tr>
              <td colspan="4" class="text-center">
                  <div class="loading">
                      <div class="spinner"></div>
                  </div>
              </td>
          </tr>
      `;
      
      database.ref('coupons').once('value')
          .then((snapshot) => {
              const couponsData = snapshot.val();
              coupons = couponsData ? Object.entries(couponsData).map(([key, value]) => ({ 
                  id: key, 
                  ...value 
              })) : [];
              
              // Display coupons
              document.getElementById('coupons-list').innerHTML = coupons.map(coupon => `
                  <tr>
                      <td>${coupon.code}</td>
                      <td>${coupon.discountValue}${coupon.type === 'percentage' ? '%' : '₹'}</td>
                      <td><span class="coupon-type type-${coupon.type}">${coupon.type}</span></td>
                      <td>
                          <button class="btn btn-sm btn-delete" onclick="deleteCoupon('${coupon.id}')">
                              <i class="fas fa-trash"></i>
                          </button>
                      </td>
                  </tr>
              `).join('');
              
              if (coupons.length === 0) {
                  document.getElementById('coupons-list').innerHTML = `
                      <tr>
                          <td colspan="4" class="text-center">No coupons yet</td>
                      </tr>
                  `;
              }
          })
          .catch((error) => {
              console.error('Error loading coupons:', error);
              Swal.fire('Error!', 'There was a problem loading coupons.', 'error');
          });
  }
  
  // Handle Add Product
  function handleAddProduct(e) {
      e.preventDefault();
      
      // Get form values
      const name = document.getElementById('product-name').value;
      const category = document.getElementById('product-category').value;
      const description = document.getElementById('product-description').value;
      const price = parseFloat(document.getElementById('product-price').value);
      const originalPrice = document.getElementById('product-original-price').value ? 
          parseFloat(document.getElementById('product-original-price').value) : null;
      
      // Process images
      const imagesText = document.getElementById('product-images').value;
      const images = imagesText.trim() !== '' ? 
          imagesText.split('\n').filter(url => url.trim() !== '') : [];
      
      // Process sizes
      const sizesText = document.getElementById('product-sizes').value;
      const sizes = sizesText.trim() !== '' ? 
          sizesText.split(',').map(size => size.trim()).filter(size => size !== '') : [];
      
      // Process colors
      const colorsText = document.getElementById('product-colors').value;
      const colors = colorsText.trim() !== '' ? 
          colorsText.split(',').map(color => color.trim()).filter(color => color !== '') : [];
      
      // Get publish option
      const publishOption = document.querySelector('input[name="product-publish"]:checked').value;
      
      const productData = {
          name: name,
          category: category,
          description: description,
          price: price,
          originalPrice: originalPrice,
          images: images,
          sizes: sizes,
          colors: colors,
          createdAt: new Date().toISOString()
      };
      
      // Determine if product should be saved as draft or published
      const dbRef = publishOption === 'draft' ? database.ref('drafts') : database.ref('products');
      
      // Add product to Firebase
      dbRef.push(productData)
          .then(() => {
              Swal.fire('Success!', `Product ${publishOption === 'draft' ? 'saved as draft' : 'published'} successfully.`, 'success');
              document.getElementById('add-product-form').reset();
              document.getElementById('image-preview-container').innerHTML = '';
              document.getElementById('sizes-tags-container').innerHTML = '';
              document.getElementById('colors-tags-container').innerHTML = '';
              loadProducts();
              loadDashboardData();
              
              // Hide the form after successful submission
              addProductFormContainer.classList.add('hidden-form');
              showAddProductFormBtn.style.display = 'block';
          })
          .catch((error) => {
              console.error('Error adding product:', error);
              Swal.fire('Error!', 'There was a problem adding the product.', 'error');
          });
  }
  
  // Upload Images Function
  async function uploadImages() {
      const fileInput = document.getElementById('fileInput');
      const files = fileInput.files;
      const status = document.getElementById('status');
      const linksArea = document.getElementById('product-images');
      const progressContainer = document.getElementById('progressContainer');
      const progressBar = document.getElementById('progressBar');
      
      if (files.length === 0) {
          status.textContent = 'Please select at least one image.';
          return;
      }
      
      progressContainer.style.display = 'block';
      status.textContent = `Uploading ${files.length} image(s)...`;
      
      const API_KEY = "fb1e98a0535ba7a8a2211622f400f5b8";
      let uploadedLinks = [];
      
      for (let i = 0; i < files.length; i++) {
          const file = files[i];
          
          // Update progress
          progressBar.style.width = `${((i) / files.length) * 100}%`;
          status.textContent = `Uploading ${i+1} of ${files.length}: ${file.name}`;
          
          try {
              const formData = new FormData();
              formData.append('image', file);
              
              const response = await fetch(`https://api.imgbb.com/1/upload?key=${API_KEY}`, {
                  method: 'POST',
                  body: formData
              });
              
              const data = await response.json();
              
              if (data.success) {
                  const imageUrl = data.data.medium.url;
                  uploadedLinks.push(imageUrl);
                  linksArea.value += imageUrl + '\n';
                  updateImagePreview();
              } else {
                  console.error('Upload failed for', file.name, data.error);
                  status.textContent = `Failed to upload ${file.name}`;
              }
          } catch (error) {
              console.error('Error uploading', file.name, error);
              status.textContent = `Error uploading ${file.name}`;
          }
      }
      
      // Final progress update and status
      progressBar.style.width = '100%';
      status.textContent = `Upload complete! ${uploadedLinks.length} of ${files.length} images uploaded successfully.`;
      
      // Re-enable button after a short delay
      setTimeout(() => {
          progressContainer.style.display = 'none';
          progressBar.style.width = '0%';
      }, 2000);
  }
  
  // Handle Edit Product
  function handleEditProduct(e) {
      e.preventDefault();
      
      const productId = document.getElementById('edit-product-id').value;
      const productType = document.getElementById('edit-product-type').value;
      
      // Get form values
      const name = document.getElementById('edit-product-name').value;
      const category = document.getElementById('edit-product-category').value;
      const description = document.getElementById('edit-product-description').value;
      const price = parseFloat(document.getElementById('edit-product-price').value);
      const originalPrice = document.getElementById('edit-product-original-price').value ? 
          parseFloat(document.getElementById('edit-product-original-price').value) : null;
      
      // Process images
      const imagesText = document.getElementById('edit-product-images').value;
      const images = imagesText.trim() !== '' ? 
          imagesText.split('\n').filter(url => url.trim() !== '') : [];
      
      // Process sizes
      const sizesText = document.getElementById('edit-product-sizes').value;
      const sizes = sizesText.trim() !== '' ? 
          sizesText.split(',').map(size => size.trim()).filter(size => size !== '') : [];
      
      // Process colors
      const colorsText = document.getElementById('edit-product-colors').value;
      const colors = colorsText.trim() !== '' ? 
          colorsText.split(',').map(color => color.trim()).filter(color => color !== '') : [];
      
      const productData = {
          name: name,
          category: category,
          description: description,
          price: price,
          originalPrice: originalPrice,
          images: images,
          sizes: sizes,
          colors: colors,
          updatedAt: new Date().toISOString()
      };
      
      // Update product in Firebase
      const dbRef = productType === 'draft' ? database.ref('drafts/' + productId) : database.ref('products/' + productId);
      
      dbRef.update(productData)
          .then(() => {
              Swal.fire('Success!', 'Product updated successfully.', 'success');
              document.getElementById('edit-product-form').reset();
              document.getElementById('editProductModal').querySelector('.btn-close').click();
              loadProducts();
              loadDashboardData();
          })
          .catch((error) => {
              console.error('Error updating product:', error);
              Swal.fire('Error!', 'There was a problem updating the product.', 'error');
          });
  }
  
  // Handle Add Coupon
  function handleAddCoupon(e) {
      e.preventDefault();
      
      const couponData = {
          code: document.getElementById('coupon-code').value.toUpperCase(),
          discountValue: parseFloat(document.getElementById('coupon-discount').value),
          type: document.getElementById('coupon-type').value
      };
      
      // Add coupon to Firebase
      database.ref('coupons/' + couponData.code).set(couponData)
          .then(() => {
              Swal.fire('Success!', 'Coupon added successfully.', 'success');
              document.getElementById('add-coupon-form').reset();
              document.getElementById('addCouponModal').querySelector('.btn-close').click();
              loadCoupons();
              loadDashboardData();
          })
          .catch((error) => {
              console.error('Error adding coupon:', error);
              Swal.fire('Error!', 'There was a problem adding the coupon.', 'error');
          });
  }
  
  // Handle Import Products
  function handleImportProducts(e) {
      e.preventDefault();
      
      const fileInput = document.getElementById('import-file');
      const importType = document.getElementById('import-type').value;
      const overwriteExisting = document.getElementById('overwrite-existing').checked;
      
      if (!fileInput.files.length) {
          Swal.fire('Error!', 'Please select a JSON file to import.', 'error');
          return;
      }
      
      const file = fileInput.files[0];
      const reader = new FileReader();
      
      reader.onload = function(e) {
          try {
              const productsData = JSON.parse(e.target.result);
              
              if (!Array.isArray(productsData)) {
                  Swal.fire('Error!', 'Invalid JSON format. Expected an array of products.', 'error');
                  return;
              }
              
              // Validate products
              const validProducts = productsData.filter(product => 
                  product.name && product.category && product.price
              );
              
              if (validProducts.length === 0) {
                  Swal.fire('Error!', 'No valid products found in the file.', 'error');
                  return;
              }
              
              // Show progress
              Swal.fire({
                  title: 'Importing Products',
                  html: `Importing ${validProducts.length} products...`,
                  allowOutsideClick: false,
                  didOpen: () => {
                      Swal.showLoading();
                  }
              });
              
              // Import products
              const dbRef = importType === 'draft' ? database.ref('drafts') : database.ref('products');
              let importedCount = 0;
              let errorCount = 0;
              
              const importPromises = validProducts.map(product => {
                  // Remove id if exists (we'll let Firebase generate new ones)
                  const { id, ...productData } = product;
                  
                  // Add timestamp
                  productData.importedAt = new Date().toISOString();
                  
                  if (!productData.createdAt) {
                      productData.createdAt = new Date().toISOString();
                  }
                  
                  return dbRef.push(productData)
                      .then(() => {
                          importedCount++;
                      })
                      .catch((error) => {
                          console.error('Error importing product:', error);
                          errorCount++;
                      });
              });
              
              Promise.all(importPromises)
                  .then(() => {
                      Swal.fire('Success!', `Successfully imported ${importedCount} products. ${errorCount > 0 ? `${errorCount} products failed to import.` : ''}`, 'success');
                      document.getElementById('import-products-form').reset();
                      document.getElementById('importProductsModal').querySelector('.btn-close').click();
                      loadProducts();
                      loadDashboardData();
                  })
                  .catch((error) => {
                      console.error('Error during import:', error);
                      Swal.fire('Error!', 'There was a problem importing products.', 'error');
                  });
              
          } catch (error) {
              console.error('Error parsing JSON:', error);
              Swal.fire('Error!', 'Invalid JSON file. Please check the file format.', 'error');
          }
      };
      
      reader.readAsText(file);
  }
  
  // Update Image Preview for Add Product Form
  function updateImagePreview() {
      const imagesText = document.getElementById('product-images').value;
      const previewContainer = document.getElementById('image-preview-container');
      previewContainer.innerHTML = '';
      
      if (imagesText.trim() === '') return;
      
      const imageUrls = imagesText.split('\n').filter(url => url.trim() !== '');
      
      imageUrls.forEach(url => {
          const img = document.createElement('img');
          img.src = url;
          img.className = 'image-preview';
          img.onerror = function() {
              this.style.display = 'none';
          };
          previewContainer.appendChild(img);
      });
  }
  
  // Update Image Preview for Edit Product Form
  function updateEditImagePreview() {
      const imagesText = document.getElementById('edit-product-images').value;
      const previewContainer = document.getElementById('edit-image-preview-container');
      previewContainer.innerHTML = '';
      
      if (imagesText.trim() === '') return;
      
      const imageUrls = imagesText.split('\n').filter(url => url.trim() !== '');
      
      imageUrls.forEach(url => {
          const img = document.createElement('img');
          img.src = url;
          img.className = 'image-preview';
          img.onerror = function() {
              this.style.display = 'none';
          };
          previewContainer.appendChild(img);
      });
  }
  
  // Update Size Tags for Add Product Form
  function updateSizeTags() {
      const sizesText = document.getElementById('product-sizes').value;
      const tagsContainer = document.getElementById('sizes-tags-container');
      tagsContainer.innerHTML = '';
      
      if (sizesText.trim() === '') return;
      
      const sizes = sizesText.split(',').map(size => size.trim()).filter(size => size !== '');
      
      sizes.forEach(size => {
          const tag = document.createElement('span');
          tag.className = 'tag';
          tag.textContent = size;
          tagsContainer.appendChild(tag);
      });
  }
  
  // Update Color Tags for Add Product Form
  function updateColorTags() {
      const colorsText = document.getElementById('product-colors').value;
      const tagsContainer = document.getElementById('colors-tags-container');
      tagsContainer.innerHTML = '';
      
      if (colorsText.trim() === '') return;
      
      const colors = colorsText.split(',').map(color => color.trim()).filter(color => color !== '');
      
      colors.forEach(color => {
          const tag = document.createElement('span');
          tag.className = 'tag color-tag';
          tag.innerHTML = `
              <span class="color-indicator" style="background-color: ${colorMap[color] || color};"></span>
              ${color}
          `;
          tagsContainer.appendChild(tag);
      });
  }
  
  // Update Size Tags for Edit Product Form
  function updateEditSizeTags() {
      const sizesText = document.getElementById('edit-product-sizes').value;
      const tagsContainer = document.getElementById('edit-sizes-tags-container');
      tagsContainer.innerHTML = '';
      
      if (sizesText.trim() === '') return;
      
      const sizes = sizesText.split(',').map(size => size.trim()).filter(size => size !== '');
      
      sizes.forEach(size => {
          const tag = document.createElement('span');
          tag.className = 'tag';
          tag.textContent = size;
          tagsContainer.appendChild(tag);
      });
  }
  
  // Update Color Tags for Edit Product Form
  function updateEditColorTags() {
      const colorsText = document.getElementById('edit-product-colors').value;
      const tagsContainer = document.getElementById('edit-colors-tags-container');
      tagsContainer.innerHTML = '';
      
      if (colorsText.trim() === '') return;
      
      const colors = colorsText.split(',').map(color => color.trim()).filter(color => color !== '');
      
      colors.forEach(color => {
          const tag = document.createElement('span');
          tag.className = 'tag color-tag';
          tag.innerHTML = `
              <span class="color-indicator" style="background-color: ${colorMap[color] || color};"></span>
              ${color}
          `;
          tagsContainer.appendChild(tag);
      });
  }
  
  // Edit Product
  function editProduct(productId, type) {
      const productsList = type === 'draft' ? drafts : products;
      const product = productsList.find(p => p.id === productId);
      
      if (product) {
          document.getElementById('edit-product-id').value = product.id;
          document.getElementById('edit-product-type').value = type;
          document.getElementById('edit-product-name').value = product.name;
          document.getElementById('edit-product-category').value = product.category;
          document.getElementById('edit-product-description').value = product.description || '';
          document.getElementById('edit-product-price').value = product.price;
          document.getElementById('edit-product-original-price').value = product.originalPrice || '';
          document.getElementById('edit-product-images').value = product.images ? product.images.join('\n') : '';
          document.getElementById('edit-product-sizes').value = product.sizes ? product.sizes.join(', ') : '';
          document.getElementById('edit-product-colors').value = product.colors ? product.colors.join(', ') : '';
          
          // Update image preview
          updateEditImagePreview();
          
          // Update tags
          updateEditSizeTags();
          updateEditColorTags();
          
          // Show the modal
          const editProductModal = new bootstrap.Modal(document.getElementById('editProductModal'));
          editProductModal.show();
      }
  }
  
  // Move Product to Draft - FIXED: Use same ID
  function moveToDraft(productId) {
      const product = products.find(p => p.id === productId);
      
      if (product) {
          // Add to drafts with the same ID
          database.ref('drafts/' + productId).set(product)
              .then(() => {
                  // Remove from products
                  database.ref('products/' + productId).remove()
                      .then(() => {
                          Swal.fire('Success!', 'Product moved to draft.', 'success');
                          loadProducts();
                          loadDashboardData();
                      })
                      .catch((error) => {
                          console.error('Error removing product:', error);
                          Swal.fire('Error!', 'There was a problem moving the product to draft.', 'error');
                      });
              })
              .catch((error) => {
                  console.error('Error adding product to drafts:', error);
                  Swal.fire('Error!', 'There was a problem moving the product to draft.', 'error');
              });
      }
  }
  
  // Move Product to Published - FIXED: Use same ID
  function moveToPublished(productId) {
      const product = drafts.find(p => p.id === productId);
      
      if (product) {
          // Add to products with the same ID
          database.ref('products/' + productId).set(product)
              .then(() => {
                  // Remove from drafts
                  database.ref('drafts/' + productId).remove()
                      .then(() => {
                          Swal.fire('Success!', 'Product published successfully.', 'success');
                          loadProducts();
                          loadDashboardData();
                      })
                      .catch((error) => {
                          console.error('Error removing product from drafts:', error);
                          Swal.fire('Error!', 'There was a problem publishing the product.', 'error');
                      });
              })
              .catch((error) => {
                  console.error('Error adding product to products:', error);
                  Swal.fire('Error!', 'There was a problem publishing the product.', 'error');
              });
      }
  }
  
  // Delete Product
  function deleteProduct(productId, type) {
      Swal.fire({
          title: 'Delete Product?',
          text: 'Are you sure you want to delete this product? This action cannot be undone.',
          icon: 'warning',
          showCancelButton: true,
          confirmButtonText: 'Yes, Delete',
          cancelButtonText: 'Cancel'
      }).then((result) => {
          if (result.isConfirmed) {
              const dbRef = type === 'draft' ? database.ref('drafts/' + productId) : database.ref('products/' + productId);
              
              dbRef.remove()
                  .then(() => {
                      Swal.fire('Success!', 'Product deleted successfully.', 'success');
                      loadProducts();
                      loadDashboardData();
                  })
                  .catch((error) => {
                      console.error('Error deleting product:', error);
                      Swal.fire('Error!', 'There was a problem deleting the product.', 'error');
                  });
          }
      });
  }
  
  // Update Order Status
  function updateOrderStatus(orderId, newStatus) {
      database.ref('orders/' + orderId).update({
          status: newStatus,
          updatedAt: new Date().toISOString()
      })
      .then(() => {
          Swal.fire('Success!', 'Order status updated successfully.', 'success');
          loadOrders();
          loadDashboardData();
      })
      .catch((error) => {
          console.error('Error updating order status:', error);
          Swal.fire('Error!', 'There was a problem updating the order status.', 'error');
      });
  }
  
  // View Order Details
  function viewOrderDetails(orderId) {
      const order = orders.find(o => o.id === orderId);
      
      if (order) {
          let orderDetails = `
              <div class="order-details-grid">
                  <div>
                      <h5>Customer Information</h5>
                      <div class="mb-3">
                          <strong>Name:</strong> ${order.name}<br>
                          <strong>Email:</strong> ${order.email}<br>
                          <strong>Phone:</strong> ${order.phone}<br>
                          <strong>Address:</strong> ${order.address}<br>
                          <strong>City:</strong> ${order.city}<br>
                          <strong>State:</strong> ${order.state}<br>
                          <strong>PIN Code:</strong> ${order.pincode}
                      </div>
                  </div>
                  <div>
                      <h5>Order Information</h5>
                      <div class="mb-3">
                          <strong>Order ID:</strong> ${order.orderId}<br>
                          <strong>Order Date:</strong> ${new Date(order.orderDate).toLocaleString()}<br>
                          <strong>Status:</strong> <span class="order-status status-${order.status}">${order.status}</span><br>
                          <strong>Payment Method:</strong> ${order.paymentMethod || 'Cash on Delivery'}<br>
                          <strong>Shipping Method:</strong> ${order.shippingMethod || 'Standard Delivery'}
                      </div>
                  </div>
              </div>
              
              <h5 class="mt-4">Order Items</h5>
              <div class="table-responsive">
                  <table class="order-items-table">
                      <thead>
                          <tr>
                              <th>Product</th>
                              <th>Price</th>
                              <th>Quantity</th>
                              <th>Total</th>
                          </tr>
                      </thead>
                      <tbody>
          `;
          
          if (order.items && order.items.length > 0) {
              order.items.forEach(item => {
                  orderDetails += `
                      <tr>
                          <td>
                              <div>${item.name}</div>
                              ${item.size ? `<div class="tag">Size: ${item.size}</div>` : ''}
                              ${item.color ? `
                                  <div class="tag color-tag">
                                      <span class="color-indicator" style="background-color: ${colorMap[item.color] || item.color};"></span>
                                      Color: ${item.color}
                                  </div>
                              ` : ''}
                          </td>
                          <td>₹${item.price}</td>
                          <td>${item.quantity}</td>
                          <td>₹${item.price * item.quantity}</td>
                      </tr>
                  `;
              });
          } else {
              orderDetails += `
                  <tr>
                      <td colspan="4">${order.productNames}</td>
                  </tr>
              `;
          }
          
          orderDetails += `
                      </tbody>
                  </table>
              </div>
              
              <div class="mt-4 p-3 bg-light rounded">
                  <div class="row">
                      <div class="col-md-6 offset-md-6">
                          <div class="d-flex justify-content-between mb-2">
                              <span>Subtotal:</span>
                              <span>${order.subtotal || '₹0'}</span>
                          </div>
                          <div class="d-flex justify-content-between mb-2">
                              <span>Shipping:</span>
                              <span>${order.shipping || '₹50'}</span>
                          </div>
                          ${order.discount && order.discount !== '₹0' ? `
                              <div class="d-flex justify-content-between mb-2">
                                  <span>Discount:</span>
                                  <span>${order.discount}</span>
                              </div>
                          ` : ''}
                          <hr>
                          <div class="d-flex justify-content-between fw-bold">
                              <span>Total:</span>
                              <span>${order.total}</span>
                          </div>
                      </div>
                  </div>
              </div>
          `;
          
          document.getElementById('order-details-body').innerHTML = orderDetails;
          
          // Show the modal
          const orderDetailsModal = new bootstrap.Modal(document.getElementById('orderDetailsModal'));
          orderDetailsModal.show();
      }
  }
  
  // Delete Coupon
  function deleteCoupon(couponId) {
      Swal.fire({
          title: 'Delete Coupon?',
          text: 'Are you sure you want to delete this coupon? This action cannot be undone.',
          icon: 'warning',
          showCancelButton: true,
          confirmButtonText: 'Yes, Delete',
          cancelButtonText: 'Cancel'
      }).then((result) => {
          if (result.isConfirmed) {
              database.ref('coupons/' + couponId).remove()
                  .then(() => {
                      Swal.fire('Success!', 'Coupon deleted successfully.', 'success');
                      loadCoupons();
                      loadDashboardData();
                  })
                  .catch((error) => {
                      console.error('Error deleting coupon:', error);
                      Swal.fire('Error!', 'There was a problem deleting the coupon.', 'error');
                  });
          }
      });
  }
  
  // Export Products to JSON
  function exportProductsToJSON() {
      // Combine published and draft products
      const allProducts = [...products, ...drafts];
      
      if (allProducts.length === 0) {
          Swal.fire('Error!', 'No products to export.', 'error');
          return;
      }
      
      // Create a JSON string
      const dataStr = JSON.stringify(allProducts, null, 2);
      const dataBlob = new Blob([dataStr], {type: 'application/json'});
      
      // Create a download link
      const url = URL.createObjectURL(dataBlob);
      const link = document.createElement('a');
      link.href = url;
      link.download = `xyzverse-products-${new Date().toISOString().split('T')[0]}.json`;
      document.body.appendChild(link);
      link.click();
      document.body.removeChild(link);
      
      Swal.fire('Success!', 'Products exported successfully.', 'success');
  }
 </script>
</body>

</html>
